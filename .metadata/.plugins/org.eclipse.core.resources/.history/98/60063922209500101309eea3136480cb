package Doctor.dao;

import java.sql.*;
import javax.swing.JOptionPane;

public class ReporterDao {

    private static Connection con;
    private static PreparedStatement ps;
    private static ResultSet rs;

    // Establish connection
    public static Connection getCon() {
        try {
            Class.forName("com.mysql.cj.jdbc.Driver");
            con = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/vasavi", "root", "HAREKRISHNA"
            );
            System.out.println("Connected successfully");
        } catch (ClassNotFoundException cnf) {
            System.out.println("Driver not found: " + cnf.getMessage());
        } catch (SQLException sql) {
            System.out.println("SQL Error: " + sql.getMessage());
        }
        return con;
    }

    // Check if doctor is currently on leave
    public static void checkDoctorLeave(String doctorId) {
        try {
            con = getCon();
            String query = "SELECT * FROM `leave` WHERE DoctorId = ? AND CURDATE() BETWEEN STR_TO_DATE(Leave_From, '%Y-%m-%d') AND STR_TO_DATE(Leave_To, '%Y-%m-%d') AND Status = 1";
            ps = con.prepareStatement(query);
            ps.setString(1, doctorId);
            rs = ps.executeQuery();

            if (rs.next()) {
                String reason = rs.getString("Reason");
                String from = rs.getString("Leave_From");
                String to = rs.getString("Leave_To");
                JOptionPane.showMessageDialog(null,
                    "Doctor ID: " + doctorId + " is currently on leave.\n" +
                    "From: " + from + "\nTo: " + to + "\nReason: " + reason,
                    "Leave Alert", JOptionPane.WARNING_MESSAGE);
            } else {
                JOptionPane.showMessageDialog(null,
                    "Doctor ID: " + doctorId + " is available today.",
                    "Availability Check", JOptionPane.INFORMATION_MESSAGE);
            }

        } catch (SQLException sql) {
            JOptionPane.showMessageDialog(null, "SQL Error: " + sql.getMessage());
        } finally {
            try {
                if (rs != null) rs.close();
                if (ps != null) ps.close();
                if (con != null) con.close();
            } catch (SQLException e) {
                System.out.println("Error closing resources: " + e.getMessage());
            }
        }
    }
}